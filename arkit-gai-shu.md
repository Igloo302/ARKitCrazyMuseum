# Untitled

ARKitå®è·µæ•™ç¨‹ï¼šç–¯ç‹‚åšç‰©é¦†![](.gitbook/assets/0.tif)

ARKit:

æ²ˆåŠ²é˜³ - 2019å¹´9æœˆ1æ—¥

ç¬¬ä¸€è¯¾ æ¦‚è¿° 4

ç¬¬äºŒè¯¾ Hello AR World 6

ç¬¬ä¸‰è¯¾ è‡ªå®šä¹‰æ¨¡å‹ 12

ç¬¬å››è¯¾ å¯»æ‰¾å¹³é¢å±•å° 17

ç¬¬äº”è¯¾ æ”¾ç½®å°æé¾™ 20

ç¬¬å…­è¯¾ è¯»æ‡‚ä¸€å¹…å›¾ 20

ç¬¬ä¸ƒè¯¾ åŒ–çŸ³ä¿®å¤æœ¯ 25

ç¬¬å…«è¯¾ ä¸€èµ·åˆå½±å§ 28

ç¬¬ä¹è¯¾ å¤šäººäº’åŠ¨å±•å… 28

ç¬¬åè¯¾ é‡Šæ”¾æ›´å¤šåˆ›æ„ 28

ç¬¬ä¸€è¯¾ æ¦‚è¿°

ARKitç®€ä»‹

ä¸»è¦ç‰¹æ€§

å¼€å‘ç¯å¢ƒ

ç¡¬ä»¶ï¼šARKitä¸èƒ½ä½¿ç”¨Simulatorè¿›è¡Œå¼€å‘ï¼Œéœ€è¦åœ¨ä¸€å°å…·æœ‰A9å¤„ç†å™¨æˆ–æ›´å¥½é…ç½®çš„iOSè®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ï¼ŒåŒ…æ‹¬iPhone 6såŠä»¥ä¸Šã€iPad 2017ç‰ˆåŠä»¥ä¸Šã€iPad Proå…¨ç³»åˆ—ç­‰æœºå‹

æµ‹è¯•ç³»ç»Ÿï¼šiOS 12.4.1

å¼€å‘è½¯ä»¶ï¼šXcode 10

è¯¾ç¨‹æ¦‚è¦

ğŸ¦•ï¸æé¾™åšç‰©é¦†

![](.gitbook/assets/1.jpeg) ![](.gitbook/assets/2.jpeg) ![](.gitbook/assets/3.jpeg)

åšç‰©é¦†

å·¥ä½œåŸç†åŠæµç¨‹

https://blog.csdn.net/u013263917/article/details/72903174

ä¸€ä¸ªç®€å•çš„ARåœºæ™¯å®ç°æ‰€éœ€è¦çš„æŠ€æœ¯å’Œå®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. å¤šåª’ä½“æ•æ‰ç°å®å›¾åƒï¼šå¦‚æ‘„åƒå¤´
2. ä¸‰ç»´å»ºæ¨¡:3Dç«‹ä½“æ¨¡å‹
3. ä¼ æ„Ÿå™¨è¿½è¸ª:ä¸»è¦è¿½è¸ªç°å®ä¸–ç•ŒåŠ¨æ€ç‰©ä½“çš„å…­è½´å˜åŒ–ï¼Œè¿™å…­è½´åˆ†åˆ«æ˜¯Xã€Yã€Zè½´ä½ç§»åŠæ—‹è½¬ã€‚å…¶ä¸­ä½ç§»ä¸‰è½´å†³å®šç‰©ä½“çš„æ–¹ä½å’Œå¤§å°ï¼Œæ—‹è½¬ä¸‰å‘¨å†³å®šç‰©ä½“æ˜¾ç¤ºçš„åŒºåŸŸã€‚
4. åæ ‡è¯†åˆ«åŠè½¬æ¢ï¼š3Dæ¨¡å‹æ˜¾ç¤ºåœ¨ç°å®å›¾åƒä¸­ä¸æ˜¯å•çº¯çš„frameåæ ‡ç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸‰ç»´çš„çŸ©é˜µåæ ‡ã€‚è¿™åŸºæœ¬ä¸Šä¹Ÿæ˜¯å­¦ä¹ ARæœ€éš¾çš„éƒ¨åˆ†ï¼Œå¥½åœ¨ARKitå¸®åŠ©æˆ‘ä»¬å¤§å¤§ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚
5. é™¤æ­¤ä¹‹å¤–ï¼ŒARè¿˜å¯ä»¥ä¸è™šæ‹Ÿç‰©ä½“è¿›è¡Œä¸€äº›äº¤äº’ã€‚

![](.gitbook/assets/4.png)

å¦å¤–è®©å¼€å‘è€…ä»¬æƒŠå–œçš„å°±æ˜¯ARKitå¯¹ Unity3Då’ŒUnrealä¹Ÿæ˜¯å…¨çº¿æ”¯æŒã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ARKitçš„æ¶æ„å›¾ï¼š![](.gitbook/assets/5.png)

[https://blog.csdn.net/xiangzhihong8/article/details/77770485](https://blog.csdn.net/xiangzhihong8/article/details/77770485)

æ ¸å¿ƒç±»

https://www.jianshu.com/p/d0721aabcbf7

ARå·¥ç¨‹ä¸­æœ‰ä¸€ä¸ªARSCNViewï¼Œå®ƒç”¨æ¥åŠ è½½3Dæ¨¡å‹çš„ARè§†å›¾çš„ï¼Œå®ƒç»§æ‰¿äºSCNViewï¼Œç›¸å¯¹çš„åŠ è½½2Dè§†å›¾çš„å°±æ˜¯ARSKViewã€‚

SpriteKitæ˜¯ç”¨æ¥åˆ›å»º2Dæ¨¡å‹ï¼Œåœ¨æ¸¸æˆå¼€å‘ä¸­ï¼ŒæŒ‡çš„æ˜¯ä»¥å›¾åƒæ–¹å¼å‘ˆç°åœ¨å±å¹•ä¸Šçš„ä¸€ä¸ªå›¾åƒã€‚è¿™ä¸ªå›¾åƒä¹Ÿè®¸å¯ä»¥ç§»åŠ¨ï¼Œç”¨æˆ·å¯ä»¥ä¸å…¶äº¤äº’ï¼Œä¹Ÿæœ‰å¯èƒ½ä»…åªæ˜¯æ¸¸æˆçš„ä¸€ä¸ªé™æ­¢çš„èƒŒæ™¯å›¾ã€‚è€Œåœ¨ARä¸­ï¼Œ2Dæ¨¡å‹ä¼šéšç€æ‰‹æœºçš„è¿œè¿‘æ”¾å¤§ç¼©å°ï¼Œè€Œä¸èƒ½åƒ3Dæ¨¡å‹é‚£æ ·å¯ä»¥ä»ä¾§é¢è§‚å¯Ÿã€‚

![](.gitbook/assets/6.png)

SCeneKitç»“æ„å›¾

ç¬¬äºŒè¯¾ Hello AR World

å®˜æ–¹ç¤ºä¾‹åˆä½“éªŒ

https://blog.csdn.net/u013263917/article/details/72903174

é¦–å…ˆæ‰“å¼€ Xcodeï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Xcodeé¡¹ç›®ï¼Œé€‰æ‹© Augmented Reality Appæ¨¡æ¿ï¼Œç‚¹å‡»Nextã€‚

![](.gitbook/assets/7.png)

å¡«ä¸Šå¿…è¦çš„é¡¹ç›®ä¿¡æ¯ï¼ŒARKitæä¾›äº†ä¸¤ç§ä¸»è¦ARæŠ€æœ¯Content Technology åˆ†åˆ«æ˜¯ï¼š åŸºäº3Dåœºæ™¯ çš„SceneKitå’ŒåŸºäº2Dåœºæ™¯çš„SpriteKitï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨ç©ºé—´ä¸­æ˜¾ç¤º3Dçš„ç‰©ä½“ï¼Œæ‰€ä»¥åœ¨Content Technology é€‰æ‹© â€œSceneKitâ€ã€‚

![](.gitbook/assets/8.png)

Xcodeä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€æ®µç®€å•çš„ARä»£ç ï¼Œè¿æ¥å¥½iOSè®¾å¤‡åï¼Œç‚¹å‡»Runåå¹¶å…è®¸æ‘„åƒå¤´æƒé™ï¼Œå°±èƒ½ä»æ‘„åƒå¤´ç”»é¢ä¸­çœ‹åˆ°ä¸€æ¶é£æœºçš„ 3D æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å›ºå®šä¸åŠ¨åœ°æ”¾ç½®åœ¨äº†ç‰©ç†ç©ºé—´ä¸­ã€‚

![](.gitbook/assets/9.png) ![](.gitbook/assets/10.png)

 **override** **func** viewDidLoad\(\) {

 **super**.viewDidLoad\(\)

 _// Set the view's delegate_

 _//_ è®¾ç½®ä»£ç†

 sceneView.delegate = **self**

 _// Show statistics such as fps and timing information_

 _//_ æ˜¾ç¤º_ARKit_çš„ç»Ÿè®¡æ•°æ®

 sceneView.showsStatistics = **true**

 _// Create a new scene_

 _//_ ä½¿ç”¨_ship.scn_ç´ æåˆ›å»ºä¸€ä¸ªæ–°çš„åœºæ™¯_scene_ï¼ˆ_scn_æ ¼å¼æ–‡ä»¶æ˜¯ä¸€ä¸ªåŸºäº_3D_å»ºæ¨¡çš„æ–‡ä»¶ï¼Œè¿™é‡Œç³»ç»Ÿæœ‰ä¸€ä¸ªé»˜è®¤çš„_3D_é£æœºï¼‰

 **let** scene = SCNScene\(named: "art.scnassets/ship.scn"\)!

 _// Set the scene to the view_

 _//_ è®¾ç½®_scene_ä¸º_SceneKit_çš„å½“å‰åœºæ™¯

 sceneView.scene = scene

 }

 **override** **func** viewWillAppear\(**\_** animated: Bool\) {

 **super**.viewWillAppear\(animated\)

 _// Create a session configuration_

 _//_ ä½¿ç”¨_ARWorldTrackingSessionConfiguration_æ¥å……åˆ†åˆ©ç”¨æ‰€æœ‰çš„è¿åŠ¨ä¿¡æ¯ï¼Œå¹¶ç»™å‡ºæœ€ä½³çš„ç»“æœã€‚

 **let** configuration = ARWorldTrackingConfiguration\(\)

 _// Run the view's session_

 _// run\(\_:options\)_å¼€å¯_ARKit_è¿›ç¨‹ï¼Œå¹¶å¼€å§‹æ•æ‰è§†é¢‘ç”»é¢ã€‚è¯¥æ–¹æ³•å°†ä¼šè®©è®¾å¤‡è¯·æ±‚ä½¿ç”¨ç›¸æœºï¼Œå¦‚æœç”¨æˆ·æ‹’ç»è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆ_ARKit_å°†æ— æ³•å·¥ä½œã€‚

 sceneView.session.run\(configuration\)

 }

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹è¿™ä¸ªAppçš„æ ¸å¿ƒä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå®˜æ–¹ç¤ºä¾‹ä»£ç çš„ä¸»è¦å·¥ä½œå°±æ˜¯å°†äº‹å…ˆå‡†å¤‡å¥½çš„3Dé£æœºæ¨¡å‹ï¼ˆart.scnassets æ–‡ä»¶å¤¹ï¼‰è®¾ç½®ä¸ºå½“å‰çš„åœºæ™¯ï¼Œå¹¶ä¸”å¯åŠ¨ARï¼Œä»£ç çš„å…·ä½“å«ä¹‰ä»¥åŠARKitæ¡†æ¶çš„æ¶æ„åŠå…·ä½“ä½¿ç”¨å°†ä¼šåœ¨åæœŸä»‹ç»ã€‚

åœ¨ä¸–ç•Œä¸­æ·»åŠ æ¨¡å‹

å‡ ä½•å›¾å½¢

éœ€è¦ä»å¤´åˆ›å»ºä¸€ä¸ªARé¡¹ç›®

https://mp.weixin.qq.com/s/dGhEtSnBqCctN5Upmj3mTg

é€šè¿‡ä¸€ä¸ªç®€å•çš„projectï¼Œåœ¨æ˜¾ç¤ºç¯å¢ƒæ”¾ç½®ä¸€ä¸ªæ­£æ–¹ä½“ï¼Œæ¥äº†è§£ARKitçš„æ ¸å¿ƒåŠŸèƒ½ä¸APIç‰¹æ€§

 // æ·»åŠ ä¸€äº›é»˜è®¤å…‰ç…§ä»¥ä¾¿çœ‹æ¸…ç«‹æ–¹ä½“çš„è¾¹ç¼˜

sceneView.autoenablesDefaultLighting = true

æ–‡å­—

è¿™æ®µä»£ç ä¸­æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚æŒ‡å®šå­—ä½“æ—¶çš„å­—ä½“å¤§å°è®¾ç½®ä¸º1.0ã€‚è¿™æ˜¯å› ä¸ºå­—ä½“å¤§å°æ˜¯åœºæ™¯å•ä½ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒä»¥ç±³ä¸ºå•ä½ï¼Œæ‰€ä»¥æŒ‡å®šå­—ä½“å¤§å°ä¸º22ï¼Œæ¯”æ–¹è¯´ï¼Œå®ƒå°†æ˜¯22ç±³å¤§ï¼Œæ¯”æˆ‘ä»¬çš„è§†å£å¤§ã€‚ç›¸åï¼Œæˆ‘ä»¬èƒ½åšçš„æ˜¯ä½¿å­—ä½“å¤§å°ä¸º1.0ï¼ŒèŠ‚ç‚¹çš„æ¯”ä¾‹æ˜¯æˆ‘ä»¬æƒ³è¦çš„å­—ä½“å¤§å°çš„å€’æ•°ï¼ˆå³1.0 / 22.0ï¼‰ï¼Œæˆ–è€…ä½¿å­—ä½“å¤§å°ä¸ºè¯¥æ•°å­—ï¼Œå¹¶ä½¿æ¯”ä¾‹å•ç‹¬ä¿ç•™ã€‚å¦‚æœæ‚¨çš„æ–‡æœ¬å¤§äºå®¹å™¨çš„å®½åº¦ï¼Œè¿™å¯èƒ½ä¸å®¹å™¨ä¸Šçš„è‡ªåŠ¨æ¢è¡Œå†²çªã€‚ Appleåœ¨è¿™ç§æƒ…å†µä¸‹çš„å»ºè®®æ˜¯ä½¿ç”¨æ™®é€šçš„å­—ä½“å¤§å°å€¼å’Œè¾ƒå°çš„ç¼©æ”¾å€¼ï¼Œä»¥ä¾¿å®¹å™¨çŸ¥é“å¦‚ä½•æ ¹æ®å­—ä½“å¤§å°å¸ƒç½®å­—ä½“

https://medium.com/s23nyc-tech/arkit-planes-3d-text-and-hit-detection-1e10335493d

å±•ç¤ºå›¾ç‰‡å’Œè§†é¢‘

![](.gitbook/assets/11.jpeg)

fish.jpg

å°†å›¾ç‰‡æ·»åŠ åˆ°Assets.xcassetsç›®å½•ä¸‹

![](.gitbook/assets/12.png)

ä¸ºäº†åœ¨ARç©ºé—´ä¸­å±•ç¤ºå›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡ ä½•ä½“SCNPlaneï¼Œåœ¨è¡¨é¢ä¸Šæ·»åŠ å›¾ç‰‡çš„æ¼«åå°„è´´å›¾ã€‚

![](.gitbook/assets/13.png)

å‘æè´¨æ·»åŠ æ¼«åå°„è´´å›¾

 **func** showImage\(x:Float = 0, y: Float = 0, z:Float = -0.2\){

 **let** material = SCNMaterial\(\)

 _//_ å°†æè´¨çš„æ¼«åå°„è´´å›¾æ”¹ä¸º_fish_å›¾ç‰‡

 **guard** **let** img = UIImage\(named: "fish"\) **else** {**return**}

 material.diffuse.contents = img

 material.lightingModel = .physicallyBased

 _//_ åˆ›å»ºä¸€ä¸ª_SCNPlane_ï¼Œå¹¶ä¿®æ”¹å…¶æè´¨

 **let** imgPlane = SCNPlane\(width: 0.3, height: 0.2\)

 imgPlane.materials = \[material\]

 **let** imgNode = SCNNode\(geometry: imgPlane\)

 imgNode.position = SCNVector3\(x,y,z\)

 sceneView.scene.rootNode.addChildNode\(imgNode\)

 }

![](.gitbook/assets/14.png)

æ˜¾ç¤ºå›¾ç‰‡

![](.gitbook/assets/15.png)

Video by Ruvim Miksanskiy from Pexels

å°†road.mp4æ·»åŠ åˆ°ARKitDemoçš„æ ¹ç›®å½•

æ·»åŠ playVideoå‡½æ•°ï¼š

**func** playVideo\(x:Float = 0, y: Float = 0, z:Float = -0.2\){

 _//_ ä»èµ„æºåŒ…ä¸­æŠ“å–æ–‡ä»¶åä¸º_road.mp4_çš„è§†é¢‘

 **guard** **let** videoURL = Bundle.main.url\(forResource: "road", withExtension: "mp4"\) **else** {**return**}

 _//_ ä¸ºè¯¥è§†é¢‘åˆ›å»ºå’Œå¯åŠ¨_AVPlayer_

 **let** avPlayerItem = AVPlayerItem\(url: videoURL\)

 **let** avPlayer = AVPlayer\(playerItem: avPlayerItem\)

 avPlayer.play\(\)

 _// AVPlayer_å®ä¾‹ä¸ä¼šè‡ªåŠ¨é‡å¤ã€‚æ­¤é€šçŸ¥å—é€šè¿‡ç›‘å¬æ’­æ”¾å™¨æ¥å®Œæˆè§†é¢‘å¾ªç¯ã€‚ç„¶åå®ƒå›åˆ°å¼€å¤´å¹¶é‡æ–°å¼€å§‹ã€‚

 NotificationCenter.default.addObserver\(

 forName: .AVPlayerItemDidPlayToEndTime,

 object: **nil**,

 queue: **nil**\) { notification **in**

 avPlayer.seek\(to: .zero\)

 avPlayer.play\(\)

 }

 _// SceneKit_ä¸ä½¿ç”¨_UIViews_ï¼Œè€Œæ˜¯ä½¿ç”¨èŠ‚ç‚¹æ¸²æŸ“åœºæ™¯ã€‚æ— æ³•ç›´æ¥æ·»åŠ _AVPlayer_ã€‚ç›¸åï¼Œè§†é¢‘æ’­æ”¾å™¨å¯ä»¥ç”¨ä½œèŠ‚ç‚¹çš„çº¹ç†æˆ–_â€œ_ææ–™_â€_ã€‚è¿™å°†è§†é¢‘å¸§æ˜ å°„åˆ°ç›¸å…³èŠ‚ç‚¹ã€‚

 **let** avMaterial = SCNMaterial\(\)

 avMaterial.diffuse.contents = avPlayer

 _//_ åˆ›å»º_SCNPlane_ï¼Œå°†ææ–™ä¿®æ”¹ä¸º_avPlayer_

 **let** videoPlane = SCNPlane\(width: 0.32, height: 0.18\)

 videoPlane.materials = \[avMaterial\]

 _//_ åˆ›å»ºå°†æˆä¸ºåœºæ™¯ä¸€éƒ¨åˆ†çš„å®é™…èŠ‚ç‚¹

 **let** videoNode = SCNNode\(geometry: videoPlane\)

 videoNode.position = SCNVector3\(x,y,z\)

 sceneView.scene.rootNode.addChildNode\(videoNode\)

 }

![](.gitbook/assets/16.png)

æ’­æ”¾è§†é¢‘

ç¬¬ä¸‰è¯¾ è‡ªå®šä¹‰æ¨¡å‹

æ·»åŠ daeæ ¼å¼ç®€å•3Dæ¨¡å‹ï¼šç”¨å»ºæ¨¡è½¯ä»¶Rhinoç­‰æ–°å»ºä¸€ä¸ªå¸¦è‰åœ°è´´å›¾çš„å°ç«‹æ–¹ä½“ã€‚å¯¼å‡ºdaeæ ¼å¼ï¼Œå¹¶å‹¾é€‰é™„å¸¦æè´¨é€‰é¡¹ï¼Œå¾—åˆ°å°ç«‹æ–¹ä½“çš„daeæ–‡ä»¶å’Œè‰åœ°è´´å›¾çš„pngæ ¼å¼ã€‚å°†ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶æ”¾å…¥ARKitDemoçš„æ ¹ç›®å½•ã€‚![](.gitbook/assets/17.png)

æ‰“å¼€ARKitDemoå·¥ç¨‹æ–‡ä»¶ï¼Œåœ¨å·¦ä¾§è¾¹æ çš„ARKitæ–‡ä»¶å¤¹ä¸Šå³é”®é€‰æ‹©æ·»åŠ æ–‡ä»¶åˆ°â€œARKitDemoâ€ï¼Œé€‰æ‹©ä¹‹å‰çš„ä¸¤ä¸ªæ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°å°ç«‹æ–¹ä½“çš„daeæ–‡ä»¶å’Œè‰åœ°è´´å›¾å·²ç»å‡ºç°åœ¨å·¦ä¾§ã€‚

ä»£ç éƒ¨åˆ†ï¼Œåœ¨viewDidLoad\( \)ä¸­æ–°å»ºåœºæ™¯ï¼Œå¹¶æ˜¾ç¤ºåœ¨çª—å£ä¸­ã€‚

 _// Create a new scene_

 **let** scene = SCNScene\(named: "cube.dae"\)!

 _// Set the scene to the view_

 sceneView.scene = scene

è¿è¡Œåæ•ˆæœ

![](.gitbook/assets/18.png)

æ·»åŠ daeæ ¼å¼çš„å¤æ‚3Dæ¨¡å‹ï¼ˆåŒ…å«å¤šä¸ªnodeï¼‰

é™¤äº†ä½¿ç”¨sceneView.sceneè¯­å¥ç›´æ¥è°ƒç”¨åŒ…å«æ¨¡å‹çš„SCNSceneå¯¹è±¡å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°†å¤–éƒ¨æ¨¡å‹å¯¼å…¥åˆ°ARKitã€‚é€šè¿‡æ–°å»ºä¸€ä¸ªSCNNodeå¯¹è±¡ï¼Œç”¨æ¥é™„ç€æ¨¡å‹å­èŠ‚ç‚¹ã€‚å½“æ¨¡å‹ä¸­å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ·»åŠ forè¯­å¥ï¼Œéå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼ŒåŠ å…¥åˆ°ä¸€ä¸ªSCNNodeå¯¹è±¡ä¸­ã€‚ä»¥ä¸€ä¸ªåŒ…å«å¤šä¸ªèŠ‚ç‚¹çš„æ±½è½¦æ¨¡å‹ä¸ºä¾‹ï¼Œå…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š

 **func** addCar\(x:Float = -0.2, y: Float = 0, z:Float = -0.2\){

 **guard** **let** carScene = SCNScene\(named: "art.scnassets/car.dae"\) **else** {**return**}

 **let** carNode = SCNNode\(\)

 **let** carSceneChildNodes = carScene.rootNode.childNodes

 _//_ éå†_carScene_çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°_carNode_ä¸­

 **for** childNode **in** carSceneChildNodes {

 carNode.addChildNode\(childNode\)

 }

 carNode.position = SCNVector3\(x,y,z\)

 _//_ ä½¿æ¨¡å‹ç­‰æ¯”ç¼©æ”¾

 carNode.scale = SCNVector3\(0.2,0.2,0.2\)

 _//_ ä½¿æ¨¡å‹æ²¿ç€_x_è½´æ—‹è½¬_90_åº¦

 carNode.eulerAngles.x = .pi/2

 sceneView.scene.rootNode.addChildNode\(carNode\)

 }

![](.gitbook/assets/19.png)

æ¨¡å‹æ ¼å¼è½¬æ¢ï¼šARKitå¯¹daeå’Œscnæ ¼å¼çš„æ¨¡å‹æ”¯æŒæ•ˆæœè¾ƒå¥½ï¼Œå…¶ä»–æ ¼å¼çš„æ¨¡å‹å¯ä»¥é€šè¿‡Xcodeå†…ç½®çš„å·¥å…·è½¬æ¢æˆscnæ ¼å¼ã€‚ä¸‹é¢å±•ç¤ºå¦‚ä½•å°†ä¸€ä¸ªåœ¨ç½‘ä¸Šä¸‹è½½çš„objæ ¼å¼çš„å°æé¾™è½¬æ¢ä¸ºscnæ ¼å¼ï¼Œå¹¶åœ¨çª—å£ä¸­æ˜¾ç¤ºã€‚

å¯¼å…¥æ–‡ä»¶çš„è¿‡ç¨‹ä¸å‰é¢çš„å°ç«‹æ–¹ä½“ç±»ä¼¼ï¼Œåœ¨ARKitDemoçš„æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªä»¥scnassetsä¸ºåç¼€çš„æ–‡ä»¶å¤¹ï¼Œå–åart.scnassetsï¼Œå°†objæ ¼å¼çš„æé¾™æ¨¡å‹å’Œè´´å›¾å¯¼å…¥ã€‚åœ¨Xcodeä¸­å¯¼å…¥ä¸Šè¿°æ–‡ä»¶å¤¹ã€‚

é€‰ä¸­objæ¨¡å‹ï¼Œé€‰æ‹©Editoré€‰é¡¹å¡ä¸‹çš„Convert to SceneKit file formatï¼Œå°±å¯ä»¥å°†æ–‡ä»¶è½¬æ¢æˆscnæ ¼å¼ã€‚ç‚¹å‡»Chirostenotes.scnæ–‡ä»¶ï¼Œæ£€æŸ¥æ¨¡å‹å°ºå¯¸å’Œä½ç½®ç­‰ä¿¡æ¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„çš„æ¨¡å‹å•ä½æ˜¯mï¼Œå¯ä»¥é€šè¿‡è°ƒèŠ‚scaleæ¥è°ƒæ•´æ¨¡å‹çš„æ˜¾ç¤ºæ¯”ä¾‹ã€‚å¹¶ä¸ºæ¨¡å‹é™„ç€å¦ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æè´¨ã€‚![](.gitbook/assets/20.png)

![](.gitbook/assets/21.png)

ä»£ç å¦‚ä¸‹

 _// Create a new scene_

 **let** scene = SCNScene\(named: "art.scnassets/Chirostenotes.scn"\)!

 _// Set the scene to the view_

 sceneView.scene = scene

å¦å¤–ä¸€ä¸ªæ–¹æ³• dae scnéƒ½å¯ç”¨

[https://www.jianshu.com/p/15101aa0eefe](https://www.jianshu.com/p/15101aa0eefe)

æ•ˆæœå¦‚å›¾

![](.gitbook/assets/22.jpeg)

ç¬¬å››è¯¾ å¯»æ‰¾å¹³é¢å±•å°

ä¸–ç•Œè·Ÿè¸ªæ˜¯ARKitçš„é‡è¦èƒ½åŠ›ï¼Œä¹Ÿæ˜¯ä»»ä½•è™šæ‹Ÿç°å®ä½“éªŒçš„åŸºæœ¬è¦æ±‚ã€‚å…³äºä¸–ç•Œè·Ÿè¸ªï¼Œè‹¹æœçš„å®˜æ–¹APIæ˜¯è¿™æ ·è§£é‡Šçš„

â€œWorld tracking provides 6 degrees of freedom tracking of the device. By finding feature points in the scene, world tracking enables performing hit-tests against the frame. Tracking can no longer be resumed once the session is paused.â€

Appleâ€™s Documentation

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸–ç•Œè·Ÿè¸ªæŒ‡çš„æ˜¯åœ¨çœŸå®ç©ºé—´å’Œè™šæ‹Ÿç©ºé—´ä¹‹é—´åˆ›å»ºä¸€ä¸ªå¯¹åº”å…³ç³»ï¼Œè®©Appè®¤è¯†å®ƒå¤„äºçš„ä¸–ç•Œç¯å¢ƒã€‚é€šè¿‡ä¸–ç•Œè·Ÿè¸ªæŠ€æœ¯å¹³é¢æ£€æµ‹ï¼ˆå‚è§planeDetectionï¼‰ï¼ŒAppèƒ½å¤Ÿæ£€æµ‹æ‘„åƒæœºç”»é¢ä¸­çš„æ°´å¹³é¢ã€ç«–ç›´é¢ï¼Œå¹¶è·å–å…¶ä½ç½®å’Œå¤§å°;ä½¿ç”¨å‘½ä¸­æµ‹è¯•æ–¹æ³•ï¼ˆå‚è§ARHitTestResult ç±»ï¼‰ï¼Œå¯ä»¥å’Œæ£€æµ‹åˆ°çš„å¹³é¢æˆ–åœºæ™¯ä¸­æ”¾ç½®çš„è™šæ‹Ÿå†…å®¹è¿›è¡Œäº¤äº’ã€‚ï¼ˆhttps://www.jianshu.com/p/1407f8bbba89ï¼‰

æˆ‘ä»¬åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­å·²ç»å­¦ä¼šäº†åœ¨ARä¸–ç•Œä¸­æ·»åŠ æ¨¡å‹å’Œè‡ªå·±æƒ³è¦çš„è™šæ‹Ÿå†…å®¹ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„å°æé¾™æ¨¡å‹èƒ½å¤Ÿç«™åœ¨å¹³é¢ä¸Šï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬è®²å­¦ä¹ å¦‚ä½•æ£€æµ‹å¹³é¢ï¼Œå¹¶ä¸”è®©å¹³é¢å¯è§†åŒ–ã€‚

é…ç½®å’Œè¿è¡ŒARä¼šè¯

é¦–å…ˆï¼Œåœ¨viewWillAppear\(\_:\)æ–¹æ³•ä¸­ï¼Œé€šè¿‡å°†ARWorldTrackingConfigurationçš„planeDetectionå±æ€§è®¾ç½®ä¸º.horizontalï¼Œè¿™å‘Šè¯‰ARKitå»æŸ¥æ‰¾ä»»ä½•æ°´å¹³é¢ã€‚ä¸€æ—¦ARKitæ£€æµ‹åˆ°ä¸€ä¸ªæ°´å¹³é¢ï¼Œè¯¥æ°´å¹³é¢å°†è¢«æ·»åŠ åˆ°sceneViewçš„sessionä¸­ã€‚

let configuration = ARWorldTrackingConfiguration\(\)

configuration.planeDetection = \[.horizontal, .vertical\]

sceneView.session.run\(configuration\)

ä¸ºäº†æ£€æµ‹æ°´å¹³é¢ï¼Œå¿…é¡»é‡‡ç”¨ARSCNViewDelegateåè®®ã€‚å°†ViewControllerç±»ä¿®æ”¹ä¸º

**class** ViewController: UIViewController, ARSCNViewDelegate {

ï½

åŒæ—¶åœ¨viewWillAppear\(\_:\)ä¸­è®¾ç½®ä»£ç†

// è®¾ç½®ä»£ç†

sceneView.delegate = **self**

å½“å¯ç”¨å¹³é¢æ£€æµ‹æ—¶ï¼ŒARKitä¼šä¸ºæ¯ä¸ªæ£€æµ‹åˆ°çš„å¹³é¢æ·»åŠ å’Œæ›´æ–°é”šç‚¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒARSCNViewç±»ä¸ºæ¯ä¸ªé”šç‚¹çš„SceneKitåœºæ™¯æ·»åŠ ä¸€ä¸ª SCNNodeå¯¹è±¡ï¼Œä»£ç†å°±ä¼šè°ƒç”¨renderer\(\_:didAdd:for:\)æ–¹æ³•ã€‚

è¿™é‡Œè¿˜å¯ä»¥æ·»åŠ ASRCNViewçš„ä¸€ä¸ªé¢å¤–åŠŸèƒ½ï¼Œä½¿ç”¨è¯¥è¡Œä»£ç å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å†åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­æŸ¥çœ‹ç‰¹å¾ç‚¹å’Œä¸–ç•Œåæ ‡åŸç‚¹ã€‚

\#if DEBUG

sceneView.debugOptions = \[ARSCNDebugOptions.showWorldOrigin, ARSCNDebugOptions.showFeaturePoints\]

\#endif

ç›®å‰ï¼ŒviewWillAppear\(\_:\)æ–¹æ³•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

override func viewWillAppear\(\_ animated: Bool\) {

super.viewWillAppear\(animated\)

 let configuration = ARWorldTrackingConfiguration\(\)

configuration.planeDetection = \[.horizontal, .vertical\]

sceneView.session.run\(configuration\)

 sceneView.delegate = self

// æ·»åŠ ä¸€äº›é»˜è®¤å…‰ç…§ä»¥ä¾¿çœ‹æ¸…ç«‹æ–¹ä½“çš„è¾¹ç¼˜

 sceneView.autoenablesDefaultLighting = true

\#if DEBUG

sceneView.debugOptions = \[ARSCNDebugOptions.showWorldOrigin, ARSCNDebugOptions.showFeaturePoints\]

\#endif

 }

å¯è§†åŒ–å¹³é¢

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ARSCNViewDelegate çš„å›è°ƒæ–¹æ³•renderer\(\_:didAdd:for:\)ï¼Œæ¯æ¬¡ ARKit æŠ¥å‘Šæ–°çš„ ARPlaneAnchoræ—¶ï¼Œå¯ä»¥åœ¨æ‘„åƒå¤´ç”»é¢ä¸­çœ‹åˆ°è¿™ä¸ªå¹³é¢ã€‚

ç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

 func renderer\(\_ renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor\) {

 // Place content only for anchors found by plane detection.

 guard let planeAnchor = anchor as? ARPlaneAnchor else { return }

 // Create a SceneKit plane to visualize the plane anchor using its position and extent.

 let plane = SCNPlane\(width: CGFloat\(planeAnchor.extent.x\), height: CGFloat\(planeAnchor.extent.z\)\)

 let planeNode = SCNNode\(geometry: plane\)

 planeNode.simdPosition = float3\(planeAnchor.center.x, 0, planeAnchor.center.z\)

 /\*

 \`SCNPlane\` is vertically oriented in its local coordinate space, so

 rotate the plane to match the horizontal orientation of \`ARPlaneAnchor\`.

 \*/

 planeNode.eulerAngles.x = -.pi / 2

 // Make the plane visualization semitransparent to clearly show real-world placement.

 planeNode.opacity = 0.25

 /\*

 Add the plane visualization to the ARKit-managed node so that it tracks

 changes in the plane anchor as plane estimation continues.

 \*/

 node.addChildNode\(planeNode\)

 }

æ›´æ–°å¹³é¢

![](.gitbook/assets/23.png)

ç¼–è¯‘è¿è¡ŒAppï¼ŒARKitå°±å¯ä»¥è¯†åˆ«ä¸åŒçš„å¹³é¢ï¼Œå¹¶ä¸”ç”¨åŠé€æ˜çš„å¹³é¢æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†æ˜¯å¹³é¢ä¸ä¼šæ­£ç¡®åœ°å˜å¤§ã€‚

éšç€ARKitæ¥æ”¶åˆ°å…³äºæˆ‘ä»¬çš„ç¯å¢ƒçš„é¢å¤–ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•ä¹‹å‰æ£€æµ‹åˆ°çš„æ°´å¹³é¢ï¼Œä»¥åˆ©ç”¨æ›´å¤§çš„è¡¨é¢ï¼Œæˆ–è€…ç”¨æ–°çš„ç¯å¢ƒä¿¡æ¯æ›´å‡†ç¡®åœ°è¡¨ç¤ºï¼Œå®ç°æ–¹æ³•renderer\(\_:didUpdate:for:\):

ä»£ç å¦‚ä¸‹ï¼š

func renderer\(\_ renderer: SCNSceneRenderer, didUpdate node: SCNNode, for anchor: ARAnchor\) {

 // Update content only for plane anchors and nodes matching the setup created in \`renderer\(\_:didAdd:for:\)\`.

 guard let planeAnchor = anchor as? ARPlaneAnchor,

 let planeNode = node.childNodes.first,

 let plane = planeNode.geometry as? SCNPlane

 else { return }

 // Plane estimation may shift the center of a plane relative to its anchor's transform.

 planeNode.simdPosition = float3\(planeAnchor.center.x, 0, planeAnchor.center.z\)

 /\*

 Plane estimation may extend the size of the plane, or combine previously detected

 planes into a larger one. In the latter case, \`ARSCNView\` automatically deletes the

 corresponding node for one plane, then calls this method to update the size of

 the remaining plane.

 \*/

 plane.width = CGFloat\(planeAnchor.extent.x\)

 plane.height = CGFloat\(planeAnchor.extent.z\)

 }

æ¯æ¬¡æ›´æ–°SceneKitèŠ‚ç‚¹çš„å±æ€§ä»¥åŒ¹é…å…¶å¯¹åº”çš„é”šï¼ˆanchorï¼‰æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚nodeå‚æ•°ä¸ºæˆ‘ä»¬æä¾›äº†é”šçš„æ›´æ–°ä½ç½®ã€‚é”šå‚æ•°ç»™å‡ºäº†æ›´æ–°åçš„å®½åº¦å’Œé«˜åº¦ã€‚æœ‰äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°ä¹‹å‰å®ç°çš„SCNPlaneï¼Œç”¨æ›´æ–°åçš„å®½åº¦å’Œé«˜åº¦åæ˜ æ–°çš„ä½ç½®ã€‚

ä¸ºäº†è®©è§†è§‰æ•ˆæœæ›´å¥½çœ‹ï¼Œè¿˜å¯ä»¥ç»™SCNPlaneæ·»åŠ ä¸Šçº¹ç†ã€‚æ‰¾ä¸€å¼ å–œæ¬¢çš„çº¹ç†å›¾ç‰‡ï¼Œæ¯”å¦‚æ‰¾ä¸€å¼ è‰åœ°çš„çº¹ç†å›¾grass.jpgï¼Œå°†å…¶æ·»åŠ åˆ°Projectçš„Assets.xcassetsä¸­ï¼Œåœ¨renderer\(\_:didAdd:for:\)æ–¹æ³•ä¿®æ”¹planeçš„æè´¨å³å¯ï¼š

 let material = SCNMaterial\(\)

let img = UIImage\(named: "grass"\)

material.diffuse.contents = img

material.lightingModel = .physicallyBased

plane.materials = \[material\]

[https://www.jianshu.com/p/7abbb3efdbcb](https://www.jianshu.com/p/7abbb3efdbcb)

[https://developer.apple.com/documentation/arkit/tracking\_and\_visualizing\_planes](https://developer.apple.com/documentation/arkit/tracking_and_visualizing_planes)

https://www.jianshu.com/p/0ec5bd03c269

https://mp.weixin.qq.com/s/ib59tBzR3GjN48q\_Dph\_\_Q

ç¬¬äº”è¯¾ æ”¾ç½®å°æé¾™

hit test feature point æ”¾ç½®ç‰©ä½“

åœ¨ç¬¬ä¸‰è¯¾çš„æ–‡ä»¶åŸºç¡€ä¸Š

æ ¹æ®ARKitåœ¨çœŸå®ä¸–ç•Œçš„å®ç‰©è¡¨é¢ä¸Šä¾¦æµ‹åˆ°çš„ç‰¹å¾ç‚¹ï¼Œæ”¾ç½®ç«‹æ–¹ä½“ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè¦æœ‰ä¸€ä¸ªhit testï¼Œå¾ˆåƒæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æµ‹è¯•ï¼Œé™¤äº†è¿™ä¸ªï¼Œæˆ‘ä»¬æ¸…æ¥šå®šä¹‰.featurePointå±äºtypeså‚æ•°ã€‚typeså‚æ•°è¦æ±‚hit testç»ç”±ARå•å…ƒçš„ç›¸æœºå›¾åƒæ¥æœå¯»çœŸå®ä¸–ç•Œçš„å®ä½“ç‰©æˆ–æ˜¯è¡¨é¢ã€‚å®ƒå†…å«è®¸å¤šç±»å‹ï¼Œä½†æœ¬æ•™å­¦ç›®å‰åªé’ˆå¯¹ç‰¹å¾ç‚¹ã€‚

ç»ç”±ç‰¹å¾ç‚¹çš„hit teståï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ç§»é™¤ç¬¬ä¸€æ¬¡hit testçš„ç»“æœï¼Œè¿™è§‚å¿µå¾ˆé‡è¦ï¼Œå› ä¸ºä¸ä¼šä¸€ç›´éƒ½æœ‰ç‰¹å¾ç‚¹ï¼ŒARKitå¹¶ä¸ä¼šä¸€ç›´ä¾¦æµ‹çœŸå®ä¸–ç•Œçš„å®ä½“ç‰©ä¸è¡¨é¢ã€‚

å¦‚æœç¬¬ä¸€æ¬¡hit testèƒ½æˆåŠŸç§»é™¤ï¼Œç„¶åæˆ‘ä»¬å°±å°†è½¬æ¢çŸ©é˜µç±»å‹matrix\_float4x4åˆ°float3ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²å¢åŠ äº†ä¸€ä¸ªextensionæ¥å®Œæˆæ­¤åŠŸèƒ½ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸€ç‰¹å¾ç‚¹ä¸Šè¾“å…¥x, yå’Œzæ¥åŠ å…¥ä¸€ä¸ªç«‹æ–¹ä½“ã€‚

https://www.jianshu.com/p/a3d1c48f0d43

åœ¨å¹³é¢ä¸Šæ”¾ç½®ç‰©ä½“

åº”ç”¨ç‰©ç†å­¦

https://www.jianshu.com/p/641af448830c

åœæ­¢å¹³é¢æ£€æµ‹

å…‰ç…§ä¼°è®¡Lighting

ç¬¬å…­è¯¾ è¯»æ‡‚ä¸€å¹…å›¾

æµç¨‹ï¼š

1. åˆ›å»ºå‚è€ƒå›¾
2. å°†å‚è€ƒå›¾æ”¾åœ¨èµ„æºç›®å½•çš„AR Resourcesç»„ä¸­
3. è®¾ç½®ARKitä¼šè¯
4. åœ¨ä¼šè¯é…ç½®ä¸­åŠ è½½å‚è€ƒå›¾
5. å¯åŠ¨ARKitä¼šè¯
6. è¯†åˆ«åˆ°å›¾åƒæ—¶æ·»åŠ é”šç‚¹å¹¶å›è°ƒ
7. è®²æƒ³è¦çš„èŠ‚ç‚¹æ¨¡å‹æ·»åŠ åˆ°åœºæ™¯ä¸­æˆ–å…¶å®ƒæ“ä½œ

ä½¿ç”¨ARKitæ¨¡æ¿æ–°å»ºä¸€ä¸ªé¡¹ç›®CrazyDetect

å¯¼å…¥å‚è€ƒå›¾åƒ![](.gitbook/assets/24.jpeg)

Photo by Huang Yingone on Unsplash![](.gitbook/assets/25.png)

![](.gitbook/assets/26.png)

warning: Unsupported Configuration: AR reference image "Mammoth" must have non-zero, positive width.

![](.gitbook/assets/27.png)

![](.gitbook/assets/28.png)

warning: Ambiguous Content: AR reference image â€œPterosaurâ€: The histogram of the image is narrow or not well distributed. Recognition works better on images with wider, flatter histograms.

é…ç½®å›¾åƒè·Ÿè¸ª

 **override** **func** viewWillAppear\(**\_** animated: Bool\) {

 **super**.viewWillAppear\(animated\)

 _//_ è®¾ç½®å‚è€ƒå›¾åƒ

 **guard** **let** referenceImages = ARReferenceImage.referenceImages\(inGroupNamed: "AR Resources", bundle: **nil**\) **else** {

 fatalError\("Missing expected asset catalog resources."\)

 }

 _// Create a session configuration_

 **let** configuration = ARWorldTrackingConfiguration\(\)

 configuration.detectionImages = referenceImages

 _// Run the view's session_

 sceneView.session.run\(configuration\)

 }

å¯è§†åŒ–æ£€æµ‹åˆ°çš„å›¾åƒ

å’Œæ£€æµ‹å¹³é¢ç›¸ä¼¼ï¼Œå½“å›¾åƒè¢«æ£€æµ‹åˆ°çš„æ—¶å€™ï¼ŒARSessionä¼šæ·»åŠ ARImageAnchorï¼Œå¹¶ä¸”è°ƒç”¨renderer\(\_:didAdd:for:\)æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

**func** renderer\(**\_** renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor\) {

 _//_ è·å–é”šç‚¹å¯¹åº”çš„å›¾ç‰‡

 **guard** **let** imageAnchor = anchor **as**? ARImageAnchor **else** { **return** }

 **let** referenceImage = imageAnchor.referenceImage

 _//_ è¾“å‡ºæ£€æµ‹åˆ°çš„å›¾ç‰‡çš„åå­—

 **let** name = referenceImage.name!

 print\("you found a \\(name\) image"\)

 _//_ åˆ›å»ºä¸€ä¸ªå¹³é¢æ¥æ˜¾ç¤ºæ£€æµ‹åˆ°çš„å›¾ç‰‡_\(_ä¸å›¾ç‰‡ç›¸åŒå¤§å°_\)_

 **let** plane = SCNPlane\(width: referenceImage.physicalSize.width,

 height: referenceImage.physicalSize.height\)

 **let** planeNode = SCNNode\(geometry: plane\)

 planeNode.opacity = 0.25

 _// \`SCNPlane\`_åœ¨å®ƒçš„æœ¬åœ°åæ ‡ç³»æ˜¯ç«–ç›´çš„_,_ ä½†_\`ARImageAnchor\`_ä¼šå‡è®¾å›¾ç‰‡åœ¨è‡ªèº«æœ¬åœ°åæ ‡ç³»ä¸­æ˜¯æ°´å¹³çš„_,_æ‰€ä»¥è¦æ—‹è½¬å¹³é¢_._

 planeNode.eulerAngles.x = -.pi / 2

 _// Add the plane visualization to the scene._

 node.addChildNode\(planeNode\)

 }

![](.gitbook/assets/29.png)

åœ¨æ£€æµ‹åˆ°çš„å›¾ç‰‡ä¸Šæ˜¾ç¤ºåŠé€æ˜é•¿æ–¹å½¢

å†ç»™è¿™ä¸ªåŠé€æ˜çš„é•¿æ–¹å½¢æ·»åŠ ä¸€ä¸ªé«˜äº®åŠ¨ç”»ï¼Œé•¿æ–¹å½¢å°±ä¼šåœ¨é«˜äº®åæ¶ˆå¤±

_//_ é«˜äº®åŠ¨ç”»

 **var** imageHighlightAction: SCNAction {

 **return** .sequence\(\[

 .wait\(duration: 0.25\),

 .fadeOpacity\(to: 0.85, duration: 0.25\),

 .fadeOpacity\(to: 0.15, duration: 0.25\),

 .fadeOpacity\(to: 0.85, duration: 0.25\),

 .fadeOut\(duration: 0.5\),

 .removeFromParentNode\(\)

 \]\)

 }

åœ¨renderer\(\_:didAdd:for:\)æ–¹æ³•è¿›è¡Œè°ƒç”¨

 _//_ æ˜¾ç¤ºé«˜äº®åŠ¨ç”»

 planeNode.runAction\(**self**.imageHighlightAction\)

æ˜¾ç¤ºä¿¡æ¯

æ˜¾ç¤ºå›¾ç‰‡

æ’­æ”¾è§†é¢‘

![](.gitbook/assets/30.png)

Video by Engin Akyurt from Pexels

å°†Tyrannosaurus.mp4å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œåˆ›å»ºå‡½æ•°makeVideoNode\(\)åˆ›å»ºç”ŸæˆåŒ…å«è§†é¢‘çš„Node

 **func** makeVideoNode\(size:CGSize \) -&gt; SCNNode?{

 _//_ ä»èµ„æºåŒ…ä¸­æŠ“å–æ–‡ä»¶åä¸º_Tyrannosaurus.mp4_çš„è§†é¢‘

 **guard** **let** videoURL = Bundle.main.url\(forResource: "Tyrannosaurus", withExtension: "mov"\) **else** {**return** **nil**}

 _//_ ä¸ºè¯¥è§†é¢‘åˆ›å»ºå’Œå¯åŠ¨_AVPlayer_

 **let** avPlayerItem = AVPlayerItem\(url: videoURL\)

 **let** avPlayer = AVPlayer\(playerItem: avPlayerItem\)

 avPlayer.play\(\)

 _// AVPlayer_å®ä¾‹ä¸ä¼šè‡ªåŠ¨é‡å¤ã€‚æ­¤é€šçŸ¥å—é€šè¿‡ç›‘å¬æ’­æ”¾å™¨æ¥å®Œæˆè§†é¢‘å¾ªç¯ã€‚ç„¶åå®ƒå›åˆ°å¼€å¤´å¹¶é‡æ–°å¼€å§‹ã€‚

 NotificationCenter.default.addObserver\(

 forName: .AVPlayerItemDidPlayToEndTime,

 object: **nil**,

 queue: **nil**\) { notification **in**

 avPlayer.seek\(to: .zero\)

 avPlayer.play\(\)

 }

æ˜¾ç¤ºæ–‡å­—

å°åŠ¨ç”»

https://www.raywenderlich.com/6957-building-a-museum-app-with-arkit-2\#toc-anchor-015

[https://www.jianshu.com/p/dfe33efbdc11](https://www.jianshu.com/p/dfe33efbdc11)

https://developer.apple.com/documentation/arkit/detecting\_images\_in\_an\_ar\_experience

ç¬¬ä¸ƒè¯¾ åŒ–çŸ³ä¿®å¤æœ¯

![](.gitbook/assets/31.png)

å¯¹è±¡è¯†åˆ«å’Œå›¾åƒè¯†åˆ«åŠŸèƒ½çš„å·¥ä½œæ–¹å¼å’Œæµç¨‹åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œä¸»è¦åŒºåˆ«åœ¨äºAppè¯†åˆ«çš„æ˜¯ä¸‰ç»´ç‰©ä½“è€Œéå¹³é¢å›¾åƒï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åˆ›å»ºæƒ³è¦è¯†åˆ«å¯¹è±¡çš„å‚è€ƒã€‚

åˆ›å»ºå‚è€ƒå¯¹è±¡

[https://developer.apple.com/documentation/arkit/scanning\_and\_detecting\_3d\_objects](https://developer.apple.com/documentation/arkit/scanning_and_detecting_3d_objects)

![](.gitbook/assets/32.png)![](.gitbook/assets/33.png)![](.gitbook/assets/34.png)

1. é€‰æ‹©iOSè®¾å¤‡
2. å®šä½å¯¹è±¡
3. å®šä¹‰è¾¹ç•Œæ¡†
4. æ‰«æå¯¹è±¡
5. è°ƒæ•´åŸç‚¹
6. æµ‹è¯•å’Œå¯¼å‡º

å¯¼å…¥å‚è€ƒå¯¹è±¡

![](.gitbook/assets/35.png)

é…ç½®å¯¹è±¡è·Ÿè¸ª

è½½å…¥å‚è€ƒå¯¹è±¡ï¼Œä¿®æ”¹ä¹‹å‰åˆ›å»ºçš„ARWorldTrackingConfiguration\(\)ç±»çš„é…ç½®ï¼Œå°±èƒ½è®©ARKitåŒæ—¶æ”¯æŒå›¾åƒè·Ÿè¸ªå’Œå¯¹è±¡è·Ÿè¸ªï¼Œä»£ç å¦‚ä¸‹ï¼š

_//_ è®¾ç½®å‚è€ƒå¯¹è±¡

 **guard** **let** referenceObjects = ARReferenceObject.referenceObjects\(inGroupNamed: "AR Objects", bundle: **nil**\) **else**{

 fatalError\("Missing expected asset catalog resources."\)

 }

 configuration.detectionObjects = referenceObjects

æ­¤æ—¶ï¼Œæ–°å¢çš„é”šç‚¹æœ‰ARImageAnchorå’ŒARObjectAnchorä¸¤ç§å¯èƒ½ï¼Œå› æ­¤è¦å†renderer\(\_:didAdd:for:\)æ–¹æ³•ä¸­è¿›è¡ŒåŒºåˆ†ï¼Œä¸ºäº†ç¨‹åºæ¸…æ™°ï¼Œå°†è¯†åˆ«åˆ°å›¾åƒå’Œå¯¹è±¡ä¹‹åçš„æ“ä½œå°è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œrenderer\(\_:didAdd:for:\)æ›¿æ¢ä¸ºï¼š

 **if** **let** imageAnchor = anchor **as**? ARImageAnchor {

 crazyImage\(imageAnchor, node\)

 }**else** **if** **let** objectAnchor = anchor **as**? ARObjectAnchor {

 crazyObject\(objectAnchor, node\)

 }

æ˜¾ç¤ºä¿¡æ¯

æ˜¾ç¤ºæ–‡å­—

![](.gitbook/assets/36.png)

_//_ è®©æ–‡å­—æœå‘æ‘„åƒå¤´

**let** billboardConstraints = SCNBillboardConstraint\(\)

textNode.constraints = \[billboardConstraints\]

æ·»åŠ å£°éŸ³

åœ¨crazyObjectï¼ˆ\_ï¼š\_ :\)æ·»åŠ ä¸€è¡Œ

 _//_ æ’­æ”¾å£°éŸ³

 node.addAudioPlayer\(SCNAudioPlayer\(source: SCNAudioSource\(fileNamed: "growls.wav"\)!\)\)

ç¬¬å…«è¯¾ ä¸€èµ·åˆå½±å§

ç¬¬ä¹è¯¾ å¤šäººäº’åŠ¨å±•å…

ç¬¬åè¯¾ é‡Šæ”¾æ›´å¤šåˆ›æ„

coreML

ARKit 3 æ–°ç‰¹æ€§ä»‹ç»

